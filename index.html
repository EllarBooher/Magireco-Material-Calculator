<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style type="text/css">
    div p {
        white-space: pre;
    }
	.tab {
		overflow: hidden;
		border: 1px solid #ccc;
		background-color: #f1f1f1;
	}
    .girl-selector {
        display:flex;
        justify-content:space-between;
        align-items:center;
		border: 1px solid #ccc;
		background-color: #f1f1f1;
    }
    .girl-selector input {
        width:100px;
    }

    .girl-editor {
        display:flex;
        align-items: center;
        text-align: center;
		border: 1px solid #ccc;
		background-color: #f1f1f1;
    }
    
    .girl-editor div {
        width:100%;
        display:inline-block;
    }

    .awaken-circles {
        height: 100px;
        display:flex;
        align-items: center;
        text-align: center;
		border: 1px solid #ccc;
		background-color: #f1f1f1;
    }    
    
    .puellaPortrait1 {
        width: 100px;
        height; 100px;
        border: 1px solid black;
        border-radius: 5px;    
    }
    
    .awakenCircleImages {
        width: 50px;
        height; 50px;
        border: 1px solid black;
        border-radius: 5px;    
    } 
    
	/* Style the buttons that are used to open the tab content */
	.tab button {
		width: 33%;
		background-color: inherit;
		float: left;
		border: none;
		outline: none;
		cursor: pointer;
		padding: 14px 16px;
		transition: 0.3s;
	}

	/* Change background color of buttons on hover */
	.tab button:hover {
		background-color: #ddd;
	}

	/* Create an active/current tablink class */
	.tab button.active {
		background-color: #ccc;
	}

	/* Style the tab content */
	.tabcontent {
		animation: fadeEffect 0.8s;
		display: none;
		padding: 6px 12px;
		border: 1px solid #ccc;
		border-top: none;
	}
	
	@keyframes fadeEffect {
		from {opacity: 0;}
		to {opacity: 1;}
	}
	</style>
	<title> Magia Record Material Calculator </title>
    <script  src="vue.min.js"></script>
	<body>
	<div class="tab">
		<button class="tablinks" onclick="openTab(event, 'A')">Select Units</button>
		<button class="tablinks" onclick="openTab(event, 'B');updateGirls()">Edit Units</button>
		<button class="tablinks" onclick="openTab(event, 'C')">Material Totals</button>
	</div>
	<div id="A" class="tabcontent">
		<span class="girl-selector" v-for="item in items">
            <img class="puellaPortrait1" v-bind:src="item.src">
            <div>{{ item.Name }}</div>
                <input v-on:click="console.log(A)" type="checkbox" id="checkbox" v-model="item.checked">
        </span>
	</div>
	<div id="B" class="tabcontent">
		<div v-for="item in items">
            <div class="girl-editor">
                <input v-on:keyup.enter="updateSpecificGirl(item)" v-model="item.currentAwaken">
                <img class="puellaPortrait1" v-bind:src="item.src">
                <div>{{ item.Name }}</div>
            </div>
            <div class="awaken-circles">
                <awaken-circle-template v-for="material in item.awakenCircles" :material="material" :key="material.ID" />
            </div>
        </div>
        
	</div>
	<div id="C" class="tabcontent">
		<p>Here goes the material interface</p>
	</div>

    <script>
        Vue.component('awaken-circle-template', {
            template: ` 
                <div>
                    <input type="checkbox" id="checkbox" true-value="12" false-value="0">
                    <p>{{ material.src }}</p>
                    <p>{{ material.name }}</p>
                </div>
            `,
            props: ['material']
        });
    </script>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            // Get all elements with class="tabcontent" and hide them
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i=0;i<tabcontent.length;i++) {
                tabcontent[i].style.display = "none";
            }
            // Get all elements with class="tablinks" and remove the class "active"
            tablinks = document.getElementsByClassName("tablinks");
            for (i=0;i<tablinks.length;i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            console.log(document.getElementById("A"))
            // Show the current tab, and add an "active" class to the button the opened it
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
        function extend(obj, src) {
            Object.keys(src).forEach(function(key) { Vue.set(obj,key,src[key]); });
            return obj;
        }
        function loadJSON(callback, url) {   
            var xobj = new XMLHttpRequest();
                xobj.overrideMimeType("application/json");
            xobj.open('GET', url, true); // Replace 'my_data' with the path to your file
            xobj.onload = function () {
                // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
                callback(xobj.responseText);
            };
            xobj.send(null);  
        }
        var puellaImages = [];
        var itemImages = [];

        function newImage(path, destination) {
            destination = new Image();
            destination.src = path;
        }
        
        var A = new Vue({
            el: '#A',
            data: {
                items: [
                ]
            }
        })
        
        var B = new Vue({
            el: '#B',
            data: {
                items: [
                ],
                images: {
                },
                itemNames: {
                },
                itemData: {
                }
            },
            methods: {
                updateSpecificGirl: function(girl) {
                    i = 0;
                    girl.awakenCircles = [];
                    for (material in girl.awakenLevel[girl.currentAwaken]) {
                        if (material != 100) {
                            var obj = new Object();
                            obj['material'] = girl.awakenLevel[girl.currentAwaken][material];
                            obj['ID'] = material;
                            obj['src'] = this.getItemProperty(material, 'src');
                            obj['name'] = this.getItemProperty(material, 'name');
                            Vue.set(girl.awakenCircles, i, obj);
                            i+=1;
                        }
                    }
                    console.log("Newly updated girl");                    
                    console.log(girl);
                },
                getItemProperty: function(ID, prop) {
                    return this.itemData[ID][prop];
                }
            }
        })
        
        for (let i = 100; i < 611; i++) {
            B.images[i] = 'itemImages/item_gift_'+i+'.png';
        };
        
        function updateGirls() {
            // For switching from the selection tab to the awaken circles tab
            B.items = [];
            for (i in A.items) {
                if (A.items[i].checked) {
                    console.log("Added "+A.items[i].Name);
                    B.items.push(extend(A.items[i],{currentAwaken: "1", currentMagia: "1", awakenCircles: [{'111': 5, 'ID': 111, 'src': '', 'name': 'flaming tostitos'}]}));
                }
            }
            console.log("B.items");
            console.log(B.items);
        }

        loadJSON(function(response) {
            // Parse girl JSON data A
            var data = JSON.parse(response);
            for (i in data) {
                var path = 'puellaImages/card_'+data[i]["ID"]+'_f.png';
                newImage(path, puellaImages[i]);
                A.items.push(extend(data[i], {src: path, checked: false}));
            }
        }, "girlData.json");

        loadJSON(function(response) {
            // Parse item name JSON data into B
            var data = JSON.parse(response);
            for (j in Object.keys(data)) {
                i = Object.keys(data)[j];
                var path = 'itemImages/item_gift_'+i+'.png';
                newImage(path, itemImages[i]);
                Vue.set(B.itemData, i, {src: path, name: data[i]});
            }
        }, "ItemNames.json");

        console.log("A");
        console.log(A);

        console.log("B");
        console.log(B);

	</script>
	</body>
</head>
</html>